{"version":3,"sources":["GameManagaer.js"],"names":["ROWS","cc","Class","extends","Component","properties","scoreLabel","Label","bestScoreLabel","blockPrefab","Prefab","bgBox","Node","cellPrefab","_gap","default","serializable","_blockSize","_data","_arrBlock","_posisions","_score","_canMove","onLoad","start","width","systemEvent","on","SystemEvent","EventType","KEY_DOWN","moveBlock","blockInit","init","log","arrInit","x","y","blockArr","Array","i","j","updateScore","row","col","getComponent","setNumber","addBlock","push","height","block","instantiate","parent","setPosition","v2","getEmptyLocations","locations","length","location","Math","floor","random","position","number","num","string","event","keyCode","macro","KEY","right","blockMoveRight","left","blockMoveLeft","up","blockMoveUp","down","blockMoveDown","updateBlockNum","afterMove","hasMoved","checkGameOver","doMove","callback","action","moveTo","finish","callFunc","runAction","sequence","doMerge","b1","b2","destroy","scale1","scaleTo","scale2","mid","n","move","toMove","count"],"mappings":"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","file":"GameManagaer.js","sourceRoot":"../../../../assets/Scripts","sourcesContent":["const ROWS = 4;\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        scoreLabel : cc.Label,\n        bestScoreLabel : cc.Label,\n        blockPrefab : cc.Prefab,\n        bgBox : cc.Node,\n        cellPrefab : cc.Prefab,\n\n        _gap :{\n            default : 10,\n            serializable : false,\n        },\n        _blockSize : null,\n        _data : [],\n        _arrBlock : [],\n        _posisions : [],\n        _score : null,\n        _canMove : true,\n    },\n\n    onLoad(){\n        this._canMove = true\n    },\n    \n    start () {\n        this._blockSize = (this.bgBox.width - this._gap * 5) / 4;\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.moveBlock, this);\n        \n        this.blockInit();\n        this.init();\n        cc.log(this._data)\n        cc.log(this._arrBlock);\n    },\n\n    arrInit( x, y){\n        let blockArr = new Array();\n        for (let i = 0; i < x; i++) {\n            blockArr[i] = new Array();\n            for (let j = 0; j < y; j++) {\n                blockArr[i][j] = 0;\n            }\n        }\n        return blockArr;\n    },\n\n    init(){\n        this.updateScore(0);\n        this._data = this. arrInit(ROWS, ROWS);\n        for (let row = 0; row < ROWS; row++) {\n            for (let col = 0; col < ROWS; col++) {\n                this._arrBlock[row][col].getComponent(\"BlockController\").setNumber(0);    \n                this._data[row][col] = 0;            \n            }\n        };   \n        this.addBlock();\n        this.addBlock();\n    },\n\n    blockInit(){\n        this._arrBlock = this.arrInit(ROWS, ROWS);\n\n        for(let i = 0; i < ROWS; i++){\n            this._posisions.push([0,0,0,0]);\n            for(let j = 0; j < ROWS; j++){\n                let x = -(this.bgBox.width / 2) + (this._gap * (j + 1) + this._blockSize / 2 * (2 * j + 1));\n                let y = (this.bgBox.height / 2) - (this._gap * (i + 1) + this._blockSize / 2 * (2 * i + 1));\n                let block = cc.instantiate(this.blockPrefab);\n                block.parent = this.bgBox;\n                block.width = this._blockSize;\n                block.height = this._blockSize;\n                block.setPosition(cc.v2(x, y));\n                this._posisions[i][j] = (cc.v2(x, y));\n                block.getComponent(\"BlockController\").setNumber(0);\n                this._arrBlock[i][j] = (block);\n            }\n        }\n       \n    },\n\n    getEmptyLocations(){\n        let locations = [];\n        for (let row = 0; row < ROWS; row++) {\n            for (let col = 0; col < ROWS; col++) {\n                if(this._data[row][col] === 0){\n                    locations.push({\n                        x : row,\n                        y : col,\n                    })\n                }                \n            }\n        }\n        return locations;\n    },\n\n    addBlock(){\n        \n        let locations = this.getEmptyLocations();\n        if(locations.length === 0) return false;\n\n        let location = locations[Math.floor(Math.random() * locations.length)];\n        let x = location.x;\n        let y = location.y;\n        let position = this._posisions[x][y];\n        let block = cc.instantiate(this.blockPrefab);\n        block.width = this._blockSize;\n        block.height = this._blockSize;\n        block.parent = this.bgBox;\n        block.setPosition(position);\n        \n        let number = Math.random() <= 0.95 ? 2 : 4;\n        block.getComponent(\"BlockController\").setNumber(number);\n        this._arrBlock[x][y] = block;\n        this._data[x][y] = number;\n\n        return true;\n    },\n\n    updateScore(num){\n        this._score = num;\n        this.scoreLabel.string = num;\n    },\n\n    moveBlock(event){\n        switch (event.keyCode) {\n            case cc.macro.KEY.right:\n                if(this._canMove){\n                    this._canMove = false\n                    this.blockMoveRight();\n                    \n                }\n                break;\n            case cc.macro.KEY.left:\n                if(this._canMove){\n                    this._canMove = false\n                    this.blockMoveLeft();\n                    \n                }\n                \n                break;\n            case cc.macro.KEY.up:\n                if(this._canMove){\n                    this._canMove = false\n                    this.blockMoveUp();\n                }\n                break;\n            case cc.macro.KEY.down:\n                if(this._canMove){\n                    this._canMove = false\n                    this.blockMoveDown();\n                    \n                }\n                break;\n        }\n    },\n\n    updateBlockNum: function () {\n        for (let row = 0; row < ROWS; row++) {\n            for (let col = 0; col < ROWS; col++) {\n                this._arrBlock[row][col].getComponent(\"BlockController\").setNumber(this._data[row][col]);\n            }\n        }\n    },\n\n    afterMove(hasMoved){\n        if(hasMoved){\n            this.updateScore(this._score + 1);\n            this.addBlock();\n            this._canMove = true\n        }\n        else if(this.checkGameOver()){\n            cc.log(\"gameOver\");\n        }\n        cc.log(this._canMove)\n    },\n\n    doMove(block, position, callback){\n        let action = cc.moveTo(.05, position);\n        let finish = cc.callFunc(()=>{\n            callback && callback();\n        })\n        block.runAction(cc.sequence(action, finish,));\n    },\n\n    doMerge(b1, b2, num, callback){\n        b1.destroy();\n        let scale1 = cc.scaleTo(0.1, 1.1);\n        let scale2 = cc.scaleTo(0.1, 1);\n        let mid = cc.callFunc(()=>{\n            b2.getComponent(\"BlockController\").setNumber(num);\n        });\n        let finish = cc.callFunc(()=>{\n            callback && callback();\n        })\n        b2.runAction(cc.sequence(scale1, mid, scale2, finish));\n    },\n\n    checkGameOver(){\n        \n        for (let i = 0; i < ROWS; i++) {\n            for (let j = 0; j < ROWS; j++) {\n                let n = this._data[i][j];\n                if(n === 0) return false;\n                if(j > 0 && this._data[i][j - 1] == n) return false;\n                if(j < ROWS - 1 && this._data[i][j + 1] == n) return false;\n                if(i > 0 && this._data[i - 1][j] == n) return false;\n                if(i < ROWS - 1 && this._data[i + 1][j] == n) return false; \n                \n            }       \n        }\n        return true;\n    },\n\n    blockMoveRight(){\n        let hasMoved = false;\n        let move = (x ,y ,callback) =>{\n            if(y == ROWS + 1 || this._data[x][y] == 0){\n                callback && callback();\n                return;\n            }else if(this._data[x][y + 1] == 0){\n                let block = this._arrBlock[x][y];\n                let position = this._posisions[x][y + 1];\n                this._arrBlock[x][y + 1] = block;\n                this._data[x][y + 1] = this._data[x][y];\n                this._data[x][y] = 0;\n                this._arrBlock[x][y] = null;\n                this.doMove(block, position, ()=>{\n                    move(x, y + 1, callback);\n                });\n                hasMoved = true;\n            }else if(this._data[x][y + 1] == this._data[x][y]){\n                let block = this._arrBlock[x][y];\n                let position = this._posisions[x][y + 1];\n               \n                this._data[x][y + 1] *= 2;\n                this._data[x][y] = 0;\n                this._arrBlock[x][y] = null\n                this.doMove(block, position, ()=>{\n                    this.doMerge(block, this._arrBlock[x][y + 1], this._data[x][y + 1],()=>{\n                        callback && callback();\n                    })\n                });\n                hasMoved = true;\n            }else{\n                callback && callback();\n                return;\n            }\n        }\n        \n        let toMove = [];\n        for (let i = 0; i < ROWS; i++) {\n            for (let j = ROWS - 1; j >= 0; j--){\n                if(this._data[i][j] != 0){\n                    toMove.push({\n                        x : i,\n                        y : j,\n                    });\n                }\n            }\n        }\n\n        let count = 0;\n        for (let i = 0; i < toMove.length; i++) {\n            move(toMove[i].x, toMove[i].y, ()=>{\n                count ++;\n                if(count == toMove.length){\n                    this.afterMove(hasMoved);\n                }\n            })\n        }\n    },\n\n    blockMoveLeft(){\n        let hasMoved = false;\n        let move = (x ,y ,callback) =>{\n            if(y == 0 || this._data[x][y] == 0){\n                callback && callback();\n                return;\n            }else if(this._data[x][y - 1] == 0){\n                let block = this._arrBlock[x][y];\n                let position = this._posisions[x][y - 1];\n                this._arrBlock[x][y - 1] = block;\n                this._data[x][y - 1] = this._data[x][y];\n                this._data[x][y] = 0;\n                this._arrBlock[x][y] = null;\n                this.doMove(block, position, ()=>{\n                    move(x, y - 1, callback);\n                });\n                hasMoved = true;\n            }else if(this._data[x][y - 1] == this._data[x][y]){\n                let block = this._arrBlock[x][y];\n                let position = this._posisions[x][y - 1];\n               \n                this._data[x][y - 1] *= 2;\n                this._data[x][y] = 0;\n                this._arrBlock[x][y] = null\n                this.doMove(block, position, ()=>{\n                    this.doMerge(block, this._arrBlock[x][y - 1], this._data[x][y - 1],()=>{\n                        callback && callback();\n                    })\n                });\n                hasMoved = true;\n            }else{\n                callback && callback();\n                return;\n            }\n        }\n        let toMove = [];\n        for (let i = 0; i < ROWS; i++) {\n            for (let j = 0; j < ROWS; j++){\n                if(this._data[i][j] != 0){\n                    toMove.push({\n                        x : i,\n                        y : j,\n                    });\n                }\n            }\n        }\n\n        let count = 0;\n        for (let i = 0; i < toMove.length; i++) {\n            move(toMove[i].x, toMove[i].y, ()=>{\n                count ++;\n                if(count == toMove.length){\n                    this.afterMove(hasMoved);\n                }\n            })\n        }\n    },\n\n    blockMoveDown(){\n        let hasMoved = false;\n        let move = (x ,y ,callback) =>{\n            if(x == ROWS - 1  || this._data[x][y] == 0){\n                callback && callback();\n                return;\n            }else if(this._data[x + 1][y] == 0){\n                let block = this._arrBlock[x][y];\n                let position = this._posisions[x + 1][y];\n                this._arrBlock[x + 1][y] = block;\n                this._data[x + 1][y] = this._data[x][y];\n                this._data[x][y] = 0;\n                this._arrBlock[x][y] = null;\n                this.doMove(block, position, ()=>{\n                    move(x + 1, y, callback);\n                });\n                hasMoved = true;\n            }else if(this._data[x + 1][y] == this._data[x][y]){\n                let block = this._arrBlock[x][y];\n                let position = this._posisions[x + 1][y];\n               \n                this._data[x + 1][y] *= 2;\n                this._data[x][y] = 0;\n                this._arrBlock[x][y] = null\n                this.doMove(block, position, ()=>{\n                    this.doMerge(block, this._arrBlock[x + 1][y], this._data[x + 1][y],()=>{\n                        callback && callback();\n                    })\n                });\n                hasMoved = true;\n            }else{\n                callback && callback();\n                return;\n            }\n        }\n        let toMove = [];\n        for (let i = ROWS - 1; i >= 0; i--) {\n            for (let j = 0; j < ROWS; j++){\n                if(this._data[i][j] != 0){\n                    toMove.push({\n                        x : i,\n                        y : j,\n                    });\n                }\n            }\n        }\n        let count = 0;\n        for (let i = 0; i < toMove.length; i++) {\n            move(toMove[i].x, toMove[i].y, ()=>{\n                count ++;\n                if(count == toMove.length){\n                    this.afterMove(hasMoved);\n                }\n            })\n        }\n    },\n\n    blockMoveUp(){\n        let hasMoved = false;\n        let move = (x ,y ,callback) =>{\n            if(x == 0  || this._data[x][y] == 0){\n                callback && callback();\n                return;\n            }else if(this._data[x - 1][y] == 0){\n                let block = this._arrBlock[x][y];\n                let position = this._posisions[x - 1][y];\n                this._arrBlock[x - 1][y] = block;\n                this._data[x - 1][y] = this._data[x][y];\n                this._data[x][y] = 0;\n                this._arrBlock[x][y] = null;\n                this.doMove(block, position, ()=>{\n                    move(x - 1, y, callback);\n                });\n                hasMoved = true;\n            }else if(this._data[x - 1][y] == this._data[x][y]){\n                let block = this._arrBlock[x][y];\n                let position = this._posisions[x - 1][y];\n               \n                this._data[x - 1][y] *= 2;\n                this._data[x][y] = 0;\n                this._arrBlock[x][y] = null\n                this.doMove(block, position, ()=>{\n                    this.doMerge(block, this._arrBlock[x - 1][y], this._data[x - 1][y],()=>{\n                        callback && callback();\n                    })\n                });\n                hasMoved = true;\n            }else{\n                callback && callback();\n                return;\n            }\n        }\n        let toMove = [];\n        for (let i = 0; i < ROWS; i++) {\n            for (let j = 0; j < ROWS; j++){\n                if(this._data[i][j] != 0){\n                    toMove.push({\n                        x : i,\n                        y : j,\n                    });\n                }\n            }\n        }\n        cc.log(toMove)\n        let count = 0;\n        for (let i = 0; i < toMove.length; i++) {\n            move(toMove[i].x, toMove[i].y, ()=>{\n                count ++;\n                if(count == toMove.length){\n                    this.afterMove(hasMoved);\n                }\n            })\n        }\n    }\n});\n"]}