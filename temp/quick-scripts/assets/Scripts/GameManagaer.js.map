{"version":3,"sources":["GameManagaer.js"],"names":["GAME_CONFIG","ROW","COL","MARGIN","ARR_BLOCK","cc","Class","extends","Component","properties","mainGame","Node","block","Prefab","score","Label","recored","loseLayout","_isChange","onLoad","systemEvent","on","SystemEvent","EventType","KEY_DOWN","onKeyDown","initObj","node","string","initBlock","addNum","y","height","x","width","index","row","col","newBlock","instantiate","setParent","setPosition","v2","label","getChildByName","getComponent","setColor","slideLeftOrUp","array","newArray","push","length","slideRightOrDown","newArr","randomXY","Math","random","number","floor","hasChangeArray","arr1","arr2","checkLeft","arr","checkRight","checkUp","m","i","checkDown","event","keyCode"],"mappings":"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","file":"GameManagaer.js","sourceRoot":"../../../../assets/Scripts","sourcesContent":["\nconst GAME_CONFIG = {\n    ROW: 4,\n    COL: 4,\n    MARGIN: 16 //results from: (this.mainGame.width - this.block.width * GAME_CONFIG.ROW) / 5;\n};\n\nconst ARR_BLOCK = [\n    [0, 0, 0, 0],\n    [0, 0, 0, 0],\n    [0, 0, 0, 0],\n    [0, 0, 0, 0],\n];\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        mainGame: cc.Node,\n        block: cc.Prefab,\n        score: cc.Label,\n        recored: cc.Label,\n        loseLayout: cc.Node, \n        _isChange: false\n    },\n\n    onLoad() {\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\n        this.initObj();\n        this.score.node.string = 0;\n    },\n\n    initObj() {\n        this.initBlock();\n        this.addNum();\n        this.addNum();\n    },\n\n    initBlock() {\n        let y = this.mainGame.height / 2 - GAME_CONFIG.MARGIN,\n            x = this.mainGame.width / -2 + GAME_CONFIG.MARGIN;\n        let index = 0;    \n        for(let row = 0; row < GAME_CONFIG.ROW; row++) {\n            for(let col = 0; col < GAME_CONFIG.COL; col++) {\n                this.newBlock = cc.instantiate(this.block); \n                this.newBlock.setParent(this.mainGame);\n                this.newBlock.setPosition(cc.v2(x, y));\n                x += this.newBlock.width + GAME_CONFIG.MARGIN;\n                if(ARR_BLOCK[row][col] != 0) {\n                    let label = this.newBlock.getChildByName(\"Value\")\n                    label.getComponent(cc.Label).string = ARR_BLOCK[row][col];\n                    this.newBlock.getComponent(\"BlockController\").setColor();\n                }\n            }\n            y -= this.newBlock.height + GAME_CONFIG.MARGIN;\n            x = this.mainGame.width / -2 + GAME_CONFIG.MARGIN;\n        };\n    },\n\n    slideLeftOrUp(array) {\n        let newArray = [];\n        for(let row = 0; row < GAME_CONFIG.ROW; row++) {\n            if(array[row] != 0) newArray.push(array[row]);\n        };\n        for(let col = newArray.length; col < GAME_CONFIG.COL; col++){\n            newArray.push(0);\n        }\n        return newArray;\n    },\n\n    slideRightOrDown(array) {\n        let newArray = [];\n        for(let row = 0; row < GAME_CONFIG.ROW; row++) {\n            if(array[row] == 0) newArray.push(array[row]);\n        };\n        for(let row = 0; row < GAME_CONFIG.ROW; row++) {\n            if(array[row] != 0) newArray.push(array[row]);\n        };\n        return newArray;\n    },\n\n    addNum() {\n        let newArr = [];\n        for(let row = 0; row < GAME_CONFIG.ROW; row++) {\n            for(let col = 0; col < GAME_CONFIG.COL; col++) { \n                if(ARR_BLOCK[row][col] == 0) {\n                    newArr.push({x: row, y: col});\n                }\n            }\n        }\n        if(newArr.length > 0) {\n            let randomXY = newArr[Math.random() * newArr.length >> 0];\n            let number = Math.floor(Math.random() * 4);\n            number < 3 ? ARR_BLOCK[randomXY.x][randomXY.y] = 2 : ARR_BLOCK[randomXY.x][randomXY.y] = 4;   \n        }\n        this.initBlock();\n    },\n\n    hasChangeArray(arr1, arr2) {\n        for(let row = 0; row < GAME_CONFIG.ROW; row++) {\n            if(arr1[row] != arr2[row]) {\n                this._isChange = true;\n            }\n        }\n    },\n\n    checkLeft() {\n        for(let row = 0; row < GAME_CONFIG.ROW; row++) {\n            let arr = ARR_BLOCK[row];\n            ARR_BLOCK[row] = this.slideLeftOrUp(ARR_BLOCK[row]);\n            for(let col = 0; col < GAME_CONFIG.COL - 1; col++) {\n                if(ARR_BLOCK[row][col] == ARR_BLOCK[row][col + 1]) {\n                    ARR_BLOCK[row][col] += ARR_BLOCK[row][col + 1];\n                    ARR_BLOCK[row][col + 1] = 0;\n                }\n            }\n            ARR_BLOCK[row] = this.slideLeftOrUp(ARR_BLOCK[row]);\n            this.hasChangeArray(arr, ARR_BLOCK[row]);\n        }\n        if(this._isChange) {\n            this.addNum();\n        }\n        this.initBlock();\n    },\n\n    checkRight() {\n        for(let row = 0; row < GAME_CONFIG.ROW; row++) {\n            let arr = ARR_BLOCK[row];\n            ARR_BLOCK[row] = this.slideRightOrDown(ARR_BLOCK[row]);\n            for(let col = 3; col > 0; col--) {\n                if(ARR_BLOCK[row][col] == ARR_BLOCK[row][col - 1]) {\n                    ARR_BLOCK[row][col] += ARR_BLOCK[row][col - 1];\n                    ARR_BLOCK[row][col - 1] = 0;\n                }\n            }\n            ARR_BLOCK[row] = this.slideRightOrDown(ARR_BLOCK[row]);\n            this.hasChangeArray(arr, ARR_BLOCK[row]);\n        }\n        if(this._isChange) {\n            this.addNum();\n        }\n        this.initBlock();\n    },\n\n    checkUp() {\n        for(let row = 0; row < GAME_CONFIG.ROW; row++) {\n            let newArr = [];\n            for(let col = 0; col < GAME_CONFIG.COL; col++) {\n                newArr.push(ARR_BLOCK[col][row]);    \n            }\n            let arr  = newArr;\n            newArr = this.slideLeftOrUp(newArr);\n            for(let m = 0; m < 3; m++) {\n                if(newArr[m] == newArr[m + 1]) {\n                    newArr[m] += newArr[m + 1];\n                    newArr[m + 1] = 0;\n                }\n            }\n            newArr = this.slideLeftOrUp(newArr);\n            for(let i = 0; i < 4; i++) {\n                ARR_BLOCK[i][row] = newArr[i];\n            }\n            this.hasChangeArray(arr, newArr);\n        }\n        if(this._isChange) {\n            this.addNum();\n        }\n        this.initBlock();\n    },\n\n    checkDown() {\n        for(let row = 0; row < GAME_CONFIG.ROW; row++) {\n            let newArr = [];\n            for(let col = 0; col < GAME_CONFIG.COL; col++) {\n                newArr.push(ARR_BLOCK[col][row]);\n            }\n            let arr  = newArr;\n            newArr = this.slideRightOrDown(newArr);\n            for(let m = 3; m > 0; m--) {\n                if(newArr[m] == newArr[m - 1]) {\n                    newArr[m] += newArr[m - 1];\n                    newArr[m - 1] = 0;\n                }\n            }\n            newArr = this.slideRightOrDown(newArr);\n            for(let i = 0; i < 4; i++) {\n                ARR_BLOCK[i][row] = newArr[i];\n            }\n            this.hasChangeArray(arr, newArr);\n        }\n        if(this._isChange) {\n            this.addNum();\n        }\n        this.initBlock();\n    },\n\n    onKeyDown(event) {\n        this._isChange = false;\n        switch(event.keyCode) {\n            case 37:\n                this.checkLeft();  \n                break;\n            case 39:\n                this.checkRight();\n                break;\n            case 38: \n                this.checkUp();\n                break;\n            case 40:\n                this.checkDown();\n        }\n    },\n});\n"]}